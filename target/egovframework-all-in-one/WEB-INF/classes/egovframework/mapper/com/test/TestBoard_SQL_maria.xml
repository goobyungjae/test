<?xml version="1.0" encoding="UTF-8"?><!-- 수정일 수정자 수정내용 ================================================================= 2011.09.21 서준식 NTT_ID를 IDGENT서비스를 사용해서 생성하므로 selectMaxNttId문은 실제 사용하지 않음 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="TestBoard">

	<select id="selectTestBoardList" parameterType="egovframework.test.board.service.TestBoardVO" resultType="egovMap">
		SELECT
			BOARD_ID
			, BOARD_TITLE
			, BOARD_CONTENTS
			, BOARD_WRITER_ID
			, BOARD_WRITER_NAME
			, BOARD_REG
			, (SELECT COUNT(*) FROM TESTCOMMENT WHERE BOARD_ID = #{boardId}) AS COMMENT_IN_BOARD_COUNT
		FROM
			TESTBOARD
		ORDER BY
			BOARD_ID
	</select>

 	<select id="selectBoardDetail" parameterType="egovframework.test.board.service.TestBoardVO" resultType="egovMap">
		SELECT
			BOARD_ID
			, BOARD_TITLE
			, BOARD_CONTENTS
			, BOARD_WRITER_ID
			, BOARD_WRITER_NAME
			, BOARD_REG
		FROM
			TESTBOARD
		WHERE
			BOARD_ID = #{boardId}
	</select>
	
	<insert id="insertTestBoard" parameterType="egovframework.test.board.service.TestBoardVO">
		INSERT INTO TESTBOARD
			( BOARD_TITLE
			, BOARD_CONTENTS
			, BOARD_WRITER_ID
			, BOARD_WRITER_NAME
			, BOARD_REG )
		VALUES
			( #{boardTitle}
			, #{boardContents}
			, #{boardWriterId}
			, #{boardWriterName}
			, NOW() )
	</insert>

	<update id="updateTestBoard" parameterType="egovframework.test.board.service.TestBoardVO">
		UPDATE 
			TESTBOARD
		SET 
			BOARD_CONTENTS = #{boardContents}
		WHERE
			BOARD_ID = #{board_id}
		AND
			BOARD_WRITER_ID = #{boardWriterId}
	</update>
	
<!-- 게시글 삭제 시 해당 게시글에 달린 댓글 전부 삭제 -->
	<delete id="deleteTestCommentAll" parameterType="egovframework.test.board.service.TestBoardVO">
		DELETE
		FROM
			TESTCOMMENT
		WHERE
			BOARD_ID = #{boardId}
	</delete>

	<delete id="deleteTestBoard" parameterType="egovframework.test.board.service.TestBoardVO">
		DELETE 
		FROM 
			TESTBOARD
		WHERE
			BOARD_ID = #{boardId}
		AND
			BOARD_WRITER_ID = #{boardWriterId}
	</delete>

	<select id="selectTestCommentList" parameterType="egovframework.test.board.service.TestCommentVO" resultType="egovMap">
		SELECT
			COMMENT_ID
			, COMMENT_wRITER_ID
			, COMMENT_WRITER_NAME
			, COMMENT_CONTENTS
			, COMMENT_REG
		FROM
			TESTCOMMENT
		WHERE 
			BOARD_ID = #{boardId}
		ORDER BY
			COMMENT_ID
	</select>
	
	<insert id="insertTestComment" parameterType="egovframework.test.board.service.TestCommentVO">
		INSERT INTO TESTCOMMENT
			( COMMENT_WRITER_ID
			, COMMENT_WRITER_NAME
			, COMMENT_CONTENTS
			, COMMENT_REG
			, BOARD_ID )
		VALUES
			( #{commentId}
			, #{commentName}
			, #{commentContents}
			, now()
			, #{boardId} )	
	</insert>
	
	<update id="updateTestComment" parameterType="egovframework.test.board.service.TestCommentVO">
		UPDATE
			TESTCOMMENT
		SET
			COMMENT_CONTENTS = #{commentContents}
		WHERE
			COMMENT_ID = #{commentId}
		AND
			COMMENT_WRITER_ID = #{commentWriterId}
	</update>
	
	<delete id="deleteTestComment" parameterType="egovframework.test.board.service.TestCommentVO">
		DELETE 
		FROM
			TESTCOMMENT
		WHERE
			COMMENT_ID = #{commentId}
		AND
			COMMENT_WRITER_ID = #{commentWriterId}
	</delete>

</mapper>